<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Spend Benchmark â€” just for fun</title>

  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.08);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --line: rgba(255,255,255,0.14);
      --accent: rgba(99,102,241,0.8);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(99,102,241,0.25), transparent 55%),
        radial-gradient(1200px 700px at 90% 30%, rgba(16,185,129,0.18), transparent 55%),
        var(--bg);
      color: var(--text);
      padding: 28px;
    }

    .wrap { max-width: 1040px; margin: 0 auto; }

    h1 {
      font-size: 34px;
      margin: 0 0 8px 0;
      letter-spacing: -0.02em;
    }

    .sub {
      color: var(--muted);
      margin-bottom: 12px;
      max-width: 720px;
    }

    .pillrow {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .pill {
      border: 1px solid var(--line);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      color: var(--muted);
      background: rgba(255,255,255,0.04);
    }

    .grid {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 16px;
      backdrop-filter: blur(10px);
    }

    h2 {
      font-size: 14px;
      text-transform: uppercase;
      color: var(--muted);
      margin: 0 0 10px 0;
      letter-spacing: 0.04em;
    }

    .freq button {
      width: 100%;
      text-align: left;
      margin-bottom: 10px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.04);
      color: var(--text);
      cursor: pointer;
    }

    .freq button.active {
      border-color: var(--accent);
      background: rgba(99,102,241,0.18);
    }

    .inputs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    @media (max-width: 700px) {
      .inputs { grid-template-columns: repeat(2, 1fr); }
    }

    .field label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }

    .field input {
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,0.3);
      color: var(--text);
      font-size: 14px;
    }

    .btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--accent);
      background: rgba(99,102,241,0.25);
      color: white;
      font-weight: 700;
      cursor: pointer;
    }

    .result {
      margin-top: 16px;
      display: none;
      background: var(--card2);
    }

    .coolTitle {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 4px;
    }

    .headline {
      font-size: 36px;
      font-weight: 900;
      margin: 6px 0;
    }

    .aiInsight {
      color: rgba(255,255,255,0.85);
      font-size: 15px;
      margin-bottom: 14px;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 14px;
    }

    .metric {
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 12px;
      background: rgba(0,0,0,0.25);
    }

    .metric .k {
      font-size: 12px;
      color: var(--muted);
    }

    .metric .v {
      font-size: 20px;
      font-weight: 800;
      margin-top: 4px;
    }

    .pctWrap { margin-top: 8px; }

    .pctBar {
      height: 14px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,0.3);
      overflow: hidden;
      position: relative;
    }

    .pctFill {
      height: 100%;
      width: 0%;
      background: rgba(99,102,241,0.7);
      transition: width 180ms ease;
    }

    .pctMarker {
      position: absolute;
      top: -6px;
      width: 2px;
      height: 26px;
      background: white;
      display: none;
      transform: translateX(-1px);
    }

    .pctTicks {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: var(--muted);
      margin-top: 6px;
    }

    .distHeader {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin: 14px 0 8px;
      font-size: 12px;
      color: var(--muted);
    }

    #hist {
      display: flex;
      gap: 6px;
      align-items: flex-end;
      height: 120px;
      overflow: hidden;
    }

    .shareBox {
      margin-top: 16px;
      padding: 14px;
      border-radius: 12px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.10);
    }

    .shareTop {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:8px;
      gap:10px;
    }

    .shareLabel {
      font-size: 13px;
      color: rgba(255,255,255,0.85);
    }

    .copyBtn {
      background: rgba(255,255,255,0.12);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 7px 12px;
      cursor: pointer;
      font-weight: 700;
    }

    #shareInsightText {
      font-size: 14px;
      line-height: 1.4;
      color: rgba(255,255,255,0.95);
      white-space: pre-wrap;
      min-height: 40px;
    }

    .footer {
      font-size: 12px;
      color: var(--muted);
      margin-top: 14px;
    }
  </style>
</head>

<body>
<div class="wrap">

  <h1>Are you a calm spenderâ€¦ or a chaotic one?</h1>
  <p class="sub">
    Enter your spend as <b>% of income</b> for the last 7 periods.
    No real income. Anonymous. Just for fun.
  </p>

  <div class="pillrow">
    <span class="pill">No income</span>
    <span class="pill">No receipts</span>
    <span class="pill">Anonymous</span>
    <span class="pill">Just for fun</span>
  </div>

  <div class="grid">

    <!-- LEFT -->
    <div class="card">
      <h2>Choose cadence</h2>
      <div class="freq">
        <button class="active" data-freq="daily">Daily</button>
        <button data-freq="weekly">Weekly</button>
        <button data-freq="monthly">Monthly</button>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <h2>Your last 7 periods (% of income)</h2>

      <div class="inputs" id="inputs"></div>

      <button class="btn" id="analyzeBtn" style="margin-top:14px;">Analyze</button>

      <div class="card result" id="resultCard">
        <div class="coolTitle" id="coolTitle">â€”</div>
        <div class="headline" id="headline">â€”</div>
        <div class="aiInsight" id="aiInsight">â€”</div>

        <div class="metrics">
          <div class="metric"><div class="k">Average spend</div><div class="v" id="avgVal">â€”</div></div>
          <div class="metric"><div class="k">Volatility</div><div class="v" id="stdVal">â€”</div></div>
          <div class="metric"><div class="k">Percentile</div><div class="v" id="pctVal">â€”</div></div>
        </div>

        <div class="pctWrap">
          <div class="pctBar">
            <div class="pctFill" id="pctFill"></div>
            <div class="pctMarker" id="pctMarker"></div>
          </div>
          <div class="pctTicks"><span>0</span><span>25</span><span>50</span><span>75</span><span>100</span></div>
        </div>

        <div class="distHeader">
          <div>Distribution (users like you)</div>
          <div id="medianText">Median: â€”</div>
        </div>

        <div id="hist"></div>

        <!-- SHAREABLE STATUS -->
        <div class="shareBox">
          <div class="shareTop">
            <div class="shareLabel">AI insight (shareable)</div>
            <button class="copyBtn" id="copyInsightBtn">Copy</button>
          </div>
          <div id="shareInsightText">Run Analyze to generate a shareable status.</div>
        </div>

        <div class="footer">
          Percentile compares you to users of this tool (not the general population).
        </div>
      </div>

    </div>
  </div>
</div>

<script>
  let frequency = "daily";
  let lastShareText = "";
  const inputsEl = document.getElementById("inputs");

  function labelsFor(freq) {
    if (freq === "daily") return ["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
    if (freq === "weekly") return ["Wk1","Wk2","Wk3","Wk4","Wk5","Wk6","Wk7"];
    return ["M1","M2","M3","M4","M5","M6","M7"];
  }

  function renderInputs() {
    inputsEl.innerHTML = "";
    labelsFor(frequency).forEach(l => {
      const d = document.createElement("div");
      d.className = "field";
      d.innerHTML = `<label>${l}</label><input type="number" min="0" max="100" placeholder="0â€“100">`;
      inputsEl.appendChild(d);
    });
  }

  document.querySelectorAll(".freq button").forEach(b => {
    b.onclick = () => {
      document.querySelectorAll(".freq button").forEach(x=>x.classList.remove("active"));
      b.classList.add("active");
      frequency = b.dataset.freq;
      renderInputs();
    };
  });

  function mean(a){ return a.reduce((x,y)=>x+y,0)/a.length; }

  function std(a){
    const m = mean(a);
    if(a.length < 2) return 0;
    return Math.sqrt(a.reduce((s,x)=>s+(x-m)**2,0)/(a.length-1));
  }

  function titleFor(avg){
    if(avg < 40) return "ðŸ§Š Zen Saver";
    if(avg < 55) return "ðŸŒ¿ Chill Budgeter";
    if(avg < 70) return "ðŸ™‚ Balanced Operator";
    if(avg < 85) return "ðŸ”¥ Spend Ninja";
    return "ðŸš€ Big Energy Spender";
  }

  function insightFor(avg,stdev,pct){
    const vol = stdev < 8 ? "steady hands" : stdev < 18 ? "a little bouncy" : "chaotic but brave";
    if (pct == null) return `You're running ${vol}.`;
    return `You're running ${vol} and spending more than ${pct}% of users.`;
  }

  async function fetchBenchmark(freq){
    const r = await fetch("/spend/benchmark", {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ frequency: freq })
    });
    if(!r.ok) throw new Error("benchmark fetch failed");
    const j = await r.json();
    return j.result;
  }

  function renderHistogram(counts, yourAvgPct){
    const hist = document.getElementById("hist");
    hist.innerHTML = "";

    if(!counts || counts.length === 0){
      hist.innerHTML = `<div style="color: rgba(255,255,255,0.65); font-size:12px;">No crowd data yet.</div>`;
      return;
    }

    const maxC = Math.max(...counts, 1);
    const binCount = counts.length;
    const idx = Math.min(binCount - 1, Math.max(0, Math.floor((yourAvgPct / 100) * binCount)));

    counts.forEach((c, i) => {
      const bar = document.createElement("div");
      const h = Math.round((c / maxC) * 110) + 6;
      bar.style.height = `${h}px`;
      bar.style.width = "14px";
      bar.style.borderRadius = "6px";
      bar.style.border = "1px solid rgba(255,255,255,0.14)";
      bar.style.background = (i === idx) ? "rgba(248,113,113,0.65)" : "rgba(255,255,255,0.10)";
      bar.title = (i === idx) ? "You" : `${c} users`;
      hist.appendChild(bar);
    });
  }

  document.getElementById("analyzeBtn").onclick = async () => {
    const values = [...document.querySelectorAll("#inputs input")].map(i => Number(i.value));

    if (values.length !== 7 || values.some(v => Number.isNaN(v))) {
      return alert("Fill all 7 boxes.");
    }
    if (values.some(v => v < 0 || v > 100)) {
      return alert("Use 0â€“100 only.");
    }

    const avgNum = mean(values);
    const sNum = std(values);

    const avg = avgNum.toFixed(2);
    const s = sNum.toFixed(2);

    let pct = null;

    try {
      const r = await fetch("/spend/analyze", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ frequency, values })
      });
      if (r.ok) {
        const j = await r.json();
        pct = j.result.percentile_rank;
        pct = (pct == null) ? null : Number(pct);
      }
    } catch {
      pct = null;
    }

    document.getElementById("coolTitle").innerText = titleFor(avgNum);
    document.getElementById("headline").innerText = `${avg}% avg spend`;
    document.getElementById("aiInsight").innerText = insightFor(avgNum, sNum, pct);

    document.getElementById("avgVal").innerText = `${avg}%`;
    document.getElementById("stdVal").innerText = `${s}%`;
    document.getElementById("pctVal").innerText = pct == null ? "â€”" : `${pct}%`;

    if (pct != null) {
      document.getElementById("pctFill").style.width = pct + "%";
      document.getElementById("pctMarker").style.left = pct + "%";
      document.getElementById("pctMarker").style.display = "block";
    } else {
      document.getElementById("pctFill").style.width = "0%";
      document.getElementById("pctMarker").style.display = "none";
    }

    document.getElementById("resultCard").style.display = "block";

    // Benchmark + histogram
    try {
      const bench = await fetchBenchmark(frequency);
      document.getElementById("medianText").innerText =
        bench.median == null ? "Median: â€”" : `Median: ${bench.median}% (n=${bench.n})`;
      renderHistogram(bench.counts, avgNum);
    } catch (e) {
      document.getElementById("medianText").innerText = "Median: â€”";
      renderHistogram([], avgNum);
    }

    // Build share text (single source of truth)
    lastShareText =
      `${document.getElementById("coolTitle").innerText}\n` +
      `${avg}% avg spend Â· ${pct == null ? "â€”" : pct + "%"} percentile\n` +
      `Volatility: ${s}%\n\n` +
      `${document.getElementById("aiInsight").innerText}\n\n` +
      `Try yours ðŸ‘‰ https://wisdom-volatility-scanner.onrender.com/`;

    document.getElementById("shareInsightText").innerText = lastShareText;
  };

  // Copy handler ONCE
  document.getElementById("copyInsightBtn").onclick = async () => {
    if (!lastShareText) return;
    await navigator.clipboard.writeText(lastShareText);
    const btn = document.getElementById("copyInsightBtn");
    const old = btn.innerText;
    btn.innerText = "Copied âœ“";
    setTimeout(() => (btn.innerText = old), 1200);
  };

  renderInputs();
</script>

</body>
</html>
